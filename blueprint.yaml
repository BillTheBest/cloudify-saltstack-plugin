tosca_definitions_version: cloudify_dsl_1_0

imports:
    -   http://www.getcloudify.org/spec/cloudify/3.1rc1/types.yaml

plugins:
    saltstack:
        executor: central_deployment_agent
        source: saltstack-plugin

node_types:
    saltification:
        derived_from: cloudify.nodes.Root
        properties:
            minion_installation_script:
                default: xxxxx
            salt_api_port:
                default: 8000
            master_ssh_user:
                default: vagrant
            master_private_ssh_key:
                default: xxxxx
            minion_config:
                default: xxxxx

node_templates:
    myhost:
        type:   cloudify.nodes.Compute
        properties:
            ip: 127.0.0.1
            cloudify_agent:
                user: vagrant
                key: /home/vagrant/.ssh/id_rsa
                wait_started_timeout: 60

    dummy abstraction layer: # cannot use lifecycle interface in Compute
        type:   saltification
        properties:
            minion_installation_script: /vagrant/plugins/saltstack-plugin/saltstack/utility/default_minion_installation.sh
            master_ssh_user: vagrant
            salt_api_port: 8000
            master_private_ssh_key: /vagrant/salt-master-key.pem
            minion_config:
                master: 192.168.50.10
                id: minion1
                log_level_logfile: info
                grains:
                    role: jboss
        interfaces:
            cloudify.interfaces.lifecycle:
                create:  saltstack.saltstack.tasks.install_minion
                configure:  saltstack.saltstack.tasks.configure_minion
                start:  saltstack.saltstack.tasks.start_minion
                stop:  saltstack.saltstack.tasks.stop_minion
        relationships:
            -   type:   cloudify.relationships.contained_in
                target: myhost
